<% title = 'Cursos' %> <!-- Establecer el título -->

<%- include('../partials/layoutsAdmin.ejs'); %> 
<body>
    <div class="wrapper">
        <%- include('../partials/sidebarAdmin.ejs'); %> 

        <div id="main-content" class="main p-3">
            <%- include('../partials/header.ejs'); %>

            <!-- contenido principal -->
            <div class="contenedor-dashboard">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="titulo-dashboard" id="tituloCurso">Lista de Cursos</h1>
                    <a href="/crearCurso" class="btn1" id="addCourseBtn">Añadir curso</a>
                </div>

                <div class="fondo-dashboard">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Curso</th>
                                <th scope="col">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="courseList">
                            <% cursos.forEach((curso, index) => { %>
                                <tr id="courseRow<%= curso.id_materia %>">
                                    <th scope="row"><%= curso.id_materia %></th>
                                    <td><%= curso.nombre %></td>
                                    <td>
                                        <a href="/ver_preguntas/<%= curso.id_materia %>" class="btn btn-sm btn-success">Ver preguntas</a>
                                        <a href="/editarCurso/<%= curso.id_materia %>" class="btn btn-sm btn-warning">Editar</a>
                                        <button class="btn btn-sm btn-danger delete-course-btn" data-id="<%= curso.id_materia %>">Eliminar</button>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Seleccionar todos los botones de eliminar curso
            document.querySelectorAll('.delete-course-btn').forEach(button => {
                button.addEventListener('click', async (event) => {
                    const courseId = event.target.getAttribute('data-id');
                    
                    const confirmed = confirm("¿Estás seguro de que deseas eliminar este curso?");
                    if (!confirmed) return;

                    try {
                        const response = await fetch(`/materias/${courseId}`, {
                            method: 'DELETE',
                        });

                        if (response.ok) {
                            alert("Curso eliminado exitosamente");
                            document.getElementById(`courseRow${courseId}`).remove(); // Eliminar el curso de la tabla sin recargar
                        } else {
                            alert("Error al eliminar el curso");
                        }
                    } catch (error) {
                        console.error("Error al enviar la solicitud de eliminación:", error);
                        alert("Error al intentar eliminar el curso.");
                    }
                });
            });
        });
    </script>

    <%- include('../partials/endPageAdmin.ejs'); %>
</body>
